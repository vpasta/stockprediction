{% extends "admin_base.html" %} {% block title %}Pelatihan Model GRU{% endblock
%} {% block page_title %} Pelatihan Model GRU Untuk {{ current_ticker }} {%
endblock %} {% block content %}

<body>
  <div class="container">
    <h1>Pelatihan Model GRU untuk {{ ticker }}</h1>

    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %} {% for category, message in messages %}
    <div class="message {{ category }}">{{ message }}</div>
    {% endfor %} {% endif %} {% endwith %}

    <div class="controls">
      <button onclick="location.href='/train';">Mulai Pelatihan Ulang</button>
      <a href="/preprocess?ticker={{ ticker }}">Kembali ke Preprocessing</a>
      <a href="/">Kembali ke Unduh Data</a>
      <div class="controls">
        <button onclick="location.href='/predict';">Lakukan Prediksi</button>
      </div>
    </div>

    <h2>Ringkasan Pelatihan</h2>
    <ul class="summary-list">
      <li><strong>Epochs:</strong> {{ epochs }}</li>
      <li><strong>Learning Rate:</strong> {{ learning_rate }}</li>
      <li><strong>Dropout Rate:</strong> {{ dropout_rate }}</li>
      <li>
        <strong>Loss Akhir (Train):</strong> {{ "%.6f"|format(final_loss) }}
      </li>
      <li>
        <strong>Loss Akhir (Val Best):</strong> {{ "%.6f"|format(final_val_loss)
        }}
      </li>
      <li>
        <strong>Durasi Pelatihan:</strong> {{ "%.2f"|format(training_duration)
        }} detik
      </li>
    </ul>

    <h2>Grafik Loss Pelatihan</h2>
    <canvas id="lossChart"></canvas>

    {% block scripts_extra %}
    <script>
      const trainLosses = {{ losses | tojson }};
      const valLosses = {{ val_losses | tojson }};
      const epochs = Array.from({length: trainLosses.length}, (_, i) => i + 1);

      const ctx = document.getElementById('lossChart').getContext('2d');
      const lossChart = new Chart(ctx, {
          type: 'line',
          data: {
              labels: epochs,
              datasets: [
                  {
                      label: 'Training Loss',
                      data: trainLosses,
                      borderColor: 'rgb(75, 192, 192)',
                      tension: 0.1,
                      fill: false
                  },
                  {
                      label: 'Validation Loss',
                      data: valLosses,
                      borderColor: 'rgb(255, 99, 132)',
                      tension: 0.1,
                      fill: false
                  }
              ]
          },
          options: {
              responsive: true,
              maintainAspectRatio: true,
              scales: {
                  x: {
                      title: {
                          display: true,
                          text: 'Epoch'
                      }
                  },
                  y: {
                      title: {
                          display: true,
                          text: 'Loss (MSE)'
                      }
                  }
              },
              plugins: {
                  title: {
                      display: true,
                      text: 'Training and Validation Loss over Epochs'
                  }
              }
          }
      });
    </script>
  </div>
  {% endblock %}
</body>
